server:
  port: 9080
  servlet:
    context-path: /offshore-wind-security
spring:
  application:
    name: Offshore-Wind-Security
  profiles:
    active: dev

  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://${datasource.host:127.0.0.1}:${datasource.port:3306}/${datasource.db:offshore_wind_security}?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8&allowPublicKeyRetrieval=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=3&initialTimeout=2
    username: ${datasource.username:root}
    password: ${datasource.password:root}
    hikari:
      # 连接池配置
      # === 核心连接池配置 ===
      # 连接池最大连接数
      maximum-pool-size: 20
      # 连接池最小空闲连接数
      minimum-idle: 5
      # 获取连接的最大等待时间(毫秒)
      connection-timeout: 30000
      # 连接空闲超时时间(毫秒) - 5分钟
      idle-timeout: 300000
      # 连接最大生命周期(毫秒) - 20分钟，防止MySQL连接超时
      max-lifetime: 1200000
      # 连接保活时间(毫秒) - 5分钟，定期验证连接有效性
      keepalive-time: 300000

      # === 连接验证配置 ===
      # 连接验证超时时间(毫秒)
      validation-timeout: 5000
      # 连接初始化SQL(可选，HikariCP会自动验证)
      connection-init-sql: SELECT 1

      # === 性能优化配置 ===
      # 是否自动提交事务
      auto-commit: true
      # 是否只读连接
      read-only: false
      # 连接池名称，便于监控识别
      pool-name: SeaWindSafe-HikariCP

      # === 监控和调试配置 ===
      # 连接泄漏检测阈值(毫秒) - 60秒
      leak-detection-threshold: 60000
      # 启用JMX监控
      register-mbeans: true
      # 允许暂停连接池(用于维护)
      allow-pool-suspension: false

      # === MySQL优化的数据源属性 ===
      data-source-properties:
        # 预编译语句缓存
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true
        # 会话状态优化
        useLocalSessionState: true
        useLocalTransactionState: true
        # 批处理优化
        rewriteBatchedStatements: true
        # 元数据缓存
        cacheResultSetMetadata: true
        cacheServerConfiguration: true
        # 性能优化
        elideSetAutoCommits: true
        maintainTimeStats: false
        # 网络优化
        tcpKeepAlive: true
        tcpNoDelay: true
        # 字符集和时区
        useUnicode: true
        # SSL配置
        useSSL: false
        allowPublicKeyRetrieval: true
        # 连接超时配置
        connectTimeout: 10000
        socketTimeout: 30000

  # SQL 初始化配置
  sql:
    init:
      mode: always
      schema-locations: classpath:sql/schema.sql

  # 允许循环引用
  main:
    allow-circular-references: true

# MyBatis Plus配置
mybatis-plus:
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    banner: false

springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: false