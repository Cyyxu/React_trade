server:
  address: 0.0.0.0
  port: 8109
  servlet:
    context-path: /api
    session:
      cookie:
        max-age: 2592000

spring:
  application:
    name: 智能 AI 校园二手交易平台
  profiles:
    active: dev

  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://120.26.104.183:3306/trade?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8&allowPublicKeyRetrieval=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=3&initialTimeout=2
    username: trade
    password: 123456
    hikari:
      # 连接池配置
      # === 核心连接池配置 ===
      # 连接池最大连接数
      maximum-pool-size: 20
      # 连接池最小空闲连接数
      minimum-idle: 5
      # 获取连接的最大等待时间(毫秒)
      connection-timeout: 30000
      # 连接空闲超时时间(毫秒) - 5分钟
      idle-timeout: 300000
      # 连接最大生命周期(毫秒) - 20分钟，防止MySQL连接超时
      max-lifetime: 1200000
      # 连接保活时间(毫秒) - 5分钟，定期验证连接有效性
      keepalive-time: 300000

      # === 连接验证配置 ===
      # 连接验证超时时间(毫秒)
      validation-timeout: 5000
      # 连接初始化SQL(可选，HikariCP会自动验证)
      connection-init-sql: SELECT 1

      # === 性能优化配置 ===
      # 是否自动提交事务
      auto-commit: true
      # 是否只读连接
      read-only: false
      # 连接池名称，便于监控识别
      pool-name: SeaWindSafe-HikariCP

      # === 监控和调试配置 ===
      # 连接泄漏检测阈值(毫秒) - 60秒
      leak-detection-threshold: 60000
      # 启用JMX监控
      register-mbeans: true
      # 允许暂停连接池(用于维护)
      allow-pool-suspension: false

      # === MySQL优化的数据源属性 ===
      data-source-properties:
        # 预编译语句缓存
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true
        # 会话状态优化
        useLocalSessionState: true
        useLocalTransactionState: true
        # 批处理优化
        rewriteBatchedStatements: true
        # 元数据缓存
        cacheResultSetMetadata: true
        cacheServerConfiguration: true
        # 性能优化
        elideSetAutoCommits: true
        maintainTimeStats: false
        # 网络优化
        tcpKeepAlive: true
        tcpNoDelay: true
        # 字符集和时区
        useUnicode: true
        # SSL配置
        useSSL: false
        allowPublicKeyRetrieval: true
        # 连接超时配置
        connectTimeout: 10000
        socketTimeout: 30000

  # Redis 配置
  redis:
    host: 120.26.104.183
    port: 6379
    password: 123321
    database: 0
    timeout: 5000

  # Session 配置
  session:
    store-type: redis
    timeout: 2592000

  # 文件上传配置
  servlet:
    multipart:
      max-file-size: 10MB

  # 允许循环引用
  main:
    allow-circular-references: true

  # Swagger3 支持
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
    async:
      request-timeout: 6000000

  # SQL 初始化配置
  sql:
    init:
      mode: always
      schema-locations: classpath:sql/schema.sql

  # Sentinel 配置
  cloud:
    sentinel:
      transport:
        dashboard: localhost:8858

# MyBatis Plus 配置
mybatis-plus:
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    banner: false
    db-config:
      logic-delete-field: isDelete
      logic-delete-value: 1
      logic-not-delete-value: 0

# Swagger 配置
springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: false

# JWT 配置
jwt:
  tokenHeader: Authorization
  secret: pX8KoX7bR3Lm9yQ1N8sT4wG2cF6eU5vH0jA7kL4mQ9oT3rF8vC1aS6dE=
  expiration: 36000000
  tokenHead: Bearer

# 讯飞星火AI配置
spark:
  appid: 74df4e55
  api-key: cd06ffe74b46ab76e53468ac90431cf5
  api-secret: NTNmODM0Y2QyZDBhNzk1YjdkZTZiMGE0

# Google Gemini AI配置
gemini:
  api-key: AIzaSyDN00Ysr_QsjXkZLWgewJZlEtaet9ZkDuA
  model: gemini-2.0-flash
  api-url: https://generativelanguage.googleapis.com/v1beta/models
  proxy:
    enabled: true
    host: 127.0.0.1
    port: 7897

# 阿里 OSS 配置
alioss:
  endpoint: oss-cn-beijing.aliyuncs.com
  access-key-id: LTAI5tSmJGuUCTkRxeG1PFqw
  access-key-secret: ywetjCcX0poK5Ww1gzY6C0KvztY7F3
  bucket-name: xujundeyun
